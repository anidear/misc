#!/bin/bash

echo "Starting from shell32_asm.nasm"
echo "--------------------------------------------"
echo "Generating shell32_asm.o ..."
nasm -f elf32 shell32_asm.nasm -o shell32_asm.o

echo "Generating shell32_asm binary file ..."
ld -melf_i386 shell32_asm.o -o shell32_asm

echo "Test dumping shell32_asm into shellcode ..."
objdump -d shell32_asm | egrep '^ [0-9a-f]+:' | tr '\t' ' '| cut -d' ' -f3-7 | sed 's/[\t ]\+$//g' | sed 's/^\|[ \r\n]\+/\\x/g' | paste -s -d ''

echo "--------------------------------------------"
echo "Starting compile shell32.c"
gcc -m32 -fno-stack-protector -z execstack -o shell32 shell32.c

echo "Run shell32"
./shell32
